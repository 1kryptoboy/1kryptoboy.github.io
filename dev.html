<html>

<head>
  <title>Data</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="css/responsive_style.css">
  <link rel="stylesheet" href="css/firebase_style.css">

  <script src="https://www.gstatic.com/firebasejs/4.8.1/firebase.js"></script>
  <script src="scripts/firebase_initialization.js"></script>
</head>

<body>
  <div class="topnav" id="myTopnav">
    <a href="index.html">login</a>
    <a href="user_info.html">user info</a>
    <a href="data.html" class="active">Data</a>
    <a href="javascript:void(0);" class="icon" onclick="myFunction()">
      <i class="fa fa-bars"></i>
    </a>
  </div>

  <h1>Data Info</h1>

  <div id="settings">permission denied</div>

  <script>
    firebase.auth().onAuthStateChanged(user => {
      console.log("in firebase.auth()")
      if (user) {
        getUserData(user.uid)
        useruid = user.uid
        console.log("user uid is: " + user.uid)
        write_data(useruid)
      }
    })

    function getUserData(uid) {
      console.log("in getuserdata()")
      firebase.database().ref('users/' + uid).once("value", snap => {
      console.log(snap.val())
      document.getElementById("settings").innerHTML = JSON.stringify(snap.val())
      })
    }

    function removeData(useruid){
      firebase.database().child.ref("users/" + useruid + "/test").remove()
        .then(function() {
          console.log("remove was successful")
        }
      ).catch(function(error) {
        console.log("remove failed " + error.message)
      })
    }

    function remove3(useruid) {
      //console.log(firebase.database().ref('users').child(useruid).child('test'))

      //ref = firebase.database().instance.ref("users/"+useruid);
      //ref.child('test').remove()
      var db = firebase.database();                   
      //var ref = db.ref("users/"+useruid); 
      //var survey = ref("test");    //Eg path is company/employee 

      remove(ref(db,"users/"+useruid+"/test"))
    }

    function remove2(useruid) {
      var db = firebase.database();
      var ref = db.ref();
      var survey=db.ref("users/"+useruid);    //Eg path is company/employee
      survey.child("test").remove();
      //var test = firebase.database().ref("users/"+useruid)
      //test.update({"test":null});         //Eg key is employee id
    }

  //throw new Error("Manual Abort Script");

    function write_data(useruid) {
      console.log("in write data user.uid is: " + useruid)
      //removeData(useruid)
      //remove2(useruid)
      remove2(useruid)
      return
      throw new Error("Manual Abort Script");

      console.log("test")
      var write_ref = firebase.database().ref("users/"+useruid);
      //testing permission denials, partioning, working so far, 07172022
      //var write_ref = firebase.database().ref("users/Tf0oa6PhbRSwUlWyduj5mOojLZI3");

      write_ref.update ({
        "deceased_profile": {
          "title" : "Captian",
          "first" : "James",
          "middle" : "James",          
          "last" : "Kirk",
          "suffix" : "II",          
          "birthdate" : "01/01/3045",
          "deceased_date" : "01/01/3085"
        },
        "services" : {
          "event1" : "viewing",
          "date" : "01/03/3085",
          "time" : "10:00 AM",
          "restrictions" : "optional mask"
        }
      });
    }


  </script>

  <script>
    function myFunction() {
      var x = document.getElementById("myTopnav");
      if (x.className === "topnav") {
        x.className += " responsive";
      } else {
        x.className = "topnav";
      }
    }
  </script>


</body>

</html>